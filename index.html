<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELLP ME - Ù…Ø¨Ø§Ø´Ø±</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 800px; margin: auto; background-color: #f0f2f5; }
        
        .header { text-align: center; margin-bottom: 30px; }
        .header h2 { color: #1a73e8; margin: 0; }
        .header p { color: #666; font-size: 14px; }

        .input-group { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        input:focus { border-color: #1a73e8; }
        
        button { padding: 12px 25px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #1557b0; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        #messages-container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); min-height: 300px; max-height: 600px; overflow-y: auto; }
        
        .message-card { border-bottom: 1px solid #f1f1f1; padding: 15px 0; animation: fadeIn 0.5s ease-in-out; }
        .message-card:last-child { border-bottom: none; }
        .msg-text { font-size: 18px; color: #333; margin-bottom: 5px; line-height: 1.5; }
        .time { font-size: 12px; color: #999; display: block; text-align: left; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <h2>Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©</h2>
        <p>Ù…ØªØµÙ„Ø© Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Firebase (Amir Project)</p>
    </div>

    <div class="input-group">
        <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø·Ù„Ø¨Ùƒ Ø£Ùˆ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
        <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
    </div>

    <div id="messages-container">
        <p style="text-align: center; color: gray; margin-top: 50px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...</p>
    </div>

    <script type="module">
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…ÙƒØªØ¨Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ²
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // âœ…âœ… ØªÙ… ÙˆØ¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§ Ø¨Ù†Ø¬Ø§Ø­ âœ…âœ…
        const firebaseConfig = {
          apiKey: "AIzaSyDZ-FQmlixBq6TvaJStsZb5TWmz5hrpTjI",
          authDomain: "help-me-4229a.firebaseapp.com",
          databaseURL: "https://help-me-4229a-default-rtdb.firebaseio.com",
          projectId: "help-me-4229a",
          storageBucket: "help-me-4229a.firebasestorage.app",
          messagingSenderId: "808831432210",
          appId: "1:808831432210:web:e5dc52c416f81dfc5acacb",
          measurementId: "G-088Q1P6E4X"
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø£Ù†Ø´Ø£Øª Firestore Database)
        const collectionName = "messages"; 

        const input = document.getElementById("msgInput");
        const btn = document.getElementById("sendBtn");
        const container = document.getElementById("messages-container");

        // ---------------------------------------------------------
        // 1. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Real-time Listener)
        // ---------------------------------------------------------
        try {
            const q = query(collection(db, collectionName), orderBy("createdAt", "desc"));
            
            onSnapshot(q, (snapshot) => {
                container.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯

                if (snapshot.empty) {
                    container.innerHTML = '<p style="text-align: center; color: #888;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¨Ø¯Ø£!</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const div = document.createElement("div");
                    div.className = "message-card";
                    
                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† ØµÙŠØºØ© Ø³ÙŠØ±ÙØ± Ù„ØµÙŠØºØ© Ù…Ù‚Ø±ÙˆØ¡Ø©
                    let timeString = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
                    if (data.createdAt) {
                        timeString = data.createdAt.toDate().toLocaleTimeString('ar-EG', { hour: '2-digit', minute:'2-digit' });
                    }

                    div.innerHTML = `
                        <div class="msg-text">${data.text}</div>
                        <span class="time">${timeString}</span>
                    `;
                    container.appendChild(div);
                });
            }, (error) => {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                container.innerHTML = `<p style="color: red; text-align: center;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}<br>ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Rules ÙÙŠ ÙØ§ÙŠØ±Ø¨ÙŠØ²</p>`;
            });

        } catch (e) {
            console.error("Error init:", e);
        }

        // ---------------------------------------------------------
        // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Sending Data)
        // ---------------------------------------------------------
        btn.addEventListener("click", async () => {
            const text = input.value;
            if (!text.trim()) return;

            try {
                btn.disabled = true;
                btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
                
                await addDoc(collection(db, collectionName), {
                    text: text,
                    createdAt: serverTimestamp()
                });

                input.value = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚Ù„
            } catch (error) {
                console.error("Error adding document: ", error);
                alert("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª");
            } finally {
                btn.disabled = false;
                btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ ğŸš€";
                input.focus();
            }
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†Ø¯ Ø¶ØºØ· Enter
        input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") btn.click();
        });

    </script>
</body>
</html>
